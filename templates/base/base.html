{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html class="loading" lang="en" data-textdirection="ltr">
<!-- BEGIN: Head-->

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta name="description" content="Frest admin is super flexible, powerful, clean &amp; modern responsive bootstrap 4 admin template with unlimited possibilities.">
    <meta name="keywords" content="admin template, Frest admin template, dashboard template, flat admin template, responsive admin template, web app">
    <meta name="author" content="PIXINVENT">
    <title>Dashboard analytics</title>
    <link rel="apple-touch-icon" href="{% static 'base/app-assets/images/ico/apple-icon-120.png' %} ">
    <link rel="shortcut icon" type="image/x-icon" href="{% static 'base/app-assets/images/ico/favicon.ico' %}">
    <link href="https://fonts.googleapis.com/css?family=Rubik:300,400,500,600%7CIBM+Plex+Sans:300,400,500,600,700" rel="stylesheet">

    <!-- BEGIN: Vendor CSS-->
    <link rel="stylesheet" type="text/css" href="{% static 'base/app-assets/vendors/css/vendors.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'baseapp-assets/vendors/css/charts/apexcharts.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'base/app-assets/vendors/css/extensions/dragula.min.css' %}">
    <!-- END: Vendor CSS-->
    <link rel="stylesheet" type="text/css" href="{% static  'base/app-assets/vendors/css/tables/datatable/datatables.min.css' %}">


    <!-- BEGIN: Theme CSS-->
    <link rel="stylesheet" type="text/css" href="{% static 'base/app-assets/css/bootstrap.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'base/app-assets/css/bootstrap-extended.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'base/app-assets/css/colors.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'base/app-assets/css/components.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'base/app-assets/css/themes/dark-layout.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'base/app-assets/css/themes/semi-dark-layout.css' %}">
    <!-- END: Theme CSS-->

    <link rel="stylesheet" type="text/css" href="{% static 'base/css/hummingbird-treeview.css' %}">

    <link rel="stylesheet" href="{% static 'base/vendor/jquery_confirm/dist/jquery-confirm.min.css' %}">

    <!-- BEGIN: Page CSS-->
    <link rel="stylesheet" type="text/css" href="{% static 'base/app-assets/css/core/menu/menu-types/vertical-menu.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'base/app-assets/css/pages/dashboard-analytics.css' %}">
    <!-- END: Page CSS-->

    <!-- BEGIN: Custom CSS-->
    <link rel="stylesheet" type="text/css" href="{% static 'base/css/spinner.css' %}">
    <!-- END: Custom CSS-->
    <!-- toastr -->
    <link rel="stylesheet" type="text/css" href="{% static 'base/app-assets/css/plugins/extensions/toastr.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'base/app-assets/css/plugins/extensions/toastr.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'base/app-assets/vendors/css/extensions/toastr.css' %}">



</head>
<!-- END: Head-->

<!-- BEGIN: Body-->

<body class="vertical-layout  vertical-menu-modern 2-columns content-left-sidebar file-manager-application navbar-sticky footer-static email-application" data-open="click" data-menu="vertical-menu-modern" data-col="2-columns" data-layout="dark-layout">

    <!-- BEGIN: Header-->
    {% block top_bar %}
    <div class="header-navbar-shadow"></div>
    <nav class="header-navbar main-header-navbar navbar-expand-lg navbar navbar-with-menu fixed-top navbar-dark">
        <div class="navbar-wrapper">
            <div class="navbar-container content navbar-dark">
                <div class="navbar-collapse" id="navbar-mobile">
                    <div class="mr-auto float-left bookmark-wrapper d-flex align-items-center">
                        <ul class="nav navbar-nav">
                            <li class="nav-item mobile-menu d-xl-none mr-auto"><a class="nav-link nav-menu-main menu-toggle hidden-xs" href="#"><i class="ficon bx bx-menu"></i></a></li>
                        </ul>
                        <ul class="nav navbar-nav bookmark-icons">
                            <!-- <div class="card bg-white m-1">
                                <li class="nav-item d-none d-lg-block"><img src="" alt="" class="flag-icon mr-50">Temp. Min: <span class=" h3 text-primary text-temperatura_min" ></span></li>
                                <li class="nav-item d-none d-lg-block"><img src="" alt="" class="flag-icon mr-50">Temp. Max: <span class="h3 text-danger text-temperatura_max" ></span></li>
                        
                            </div> -->
                        </ul>
                       
                        
                    </div>
                    <ul class="nav navbar-nav float-right">
                        
                        <!-- <li class="nav-item d-none d-lg-block"><a class="nav-link nav-link-expand"><i class="ficon bx bx-fullscreen"></i></a></li> -->
                       
                        
                        <li class="dropdown dropdown-user nav-item"><a class="dropdown-toggle nav-link dropdown-user-link" href="#" data-toggle="dropdown">
                                <div class="user-nav d-sm-flex d-none"><span class="user-name">{{ request.user.get_full_name}}</span></div><span><img class="round" {% if user.img_perfil %} src="{{user.img_perfil.url}}" {% else %} src="{% static 'base/img/profile/no_perfil.png' %}" {% endif %}  alt="avatar" height="40" width="40"></span>
                            </a>
                            <div class="dropdown-menu dropdown-menu-right pb-0"><a class="dropdown-item" href="{% url 'usr:edit_user' request.user.id %}"><i class="bx bx-user mr-50"></i> Editar perfil</a>
                                <div class="dropdown-divider mb-0"></div><a class="dropdown-item" onclick="abrir_modal('{% url 'bases:logout' %}')"><i class="bx bx-power-off mr-50"></i> Cerrar Sesión</a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>
    {% endblock top_bar %}
    <!-- END: Header-->

    <!-- BEGIN: Main Menu-->
    {% block side_bar %}
    <div class="main-menu menu-fixed menu-dark menu-accordion menu-shadow" data-scroll-to-active="true">
        <div class="navbar-header">
            <ul class="nav navbar-nav flex-row">
                <li class="nav-item mr-auto"><a class="navbar-brand" href="{% url 'bases:inicio' %}">
                        <div class="brand-logo"></div>
                        <h2 class="brand-text mb-0">Frutyfi <i class="bx bx-sun"></i></h2>
                    </a></li>
                <li class="nav-item nav-toggle"><a class="nav-link modern-nav-toggle pr-0" data-toggle="collapse"><i class="bx bx-x d-block d-xl-none font-medium-4 primary"></i><i class="toggle-icon bx bx-disc font-medium-4 d-none d-xl-block primary" data-ticon="bx-disc"></i></a></li>
            </ul>
        </div>
        <div class="shadow-bottom"></div>
        <div class="main-menu-content">
            <ul class="navigation navigation-main" id="main-menu-navigation" data-menu="menu-navigation" data-icon-style="lines">
                <!-- <li class=" nav-item"><a href="../../../html/ltr/vertical-menu-template-dark/index.html"><i class="bx bx-desktop"></i><span class="menu-title" data-i18n="Dashboard">Dashboard</span><span class="badge badge-light-danger badge-pill badge-round float-right mr-2">2</span></a>
                    <ul class="menu-content">
                        <li><a href="dashboard-ecommerce.html"><i class="bx bx-right-arrow-alt"></i><span class="menu-item" data-i18n="eCommerce">eCommerce</span></a>
                        </li>
                        <li class="active"><a href="dashboard-analytics.html"><i class="bx bx-right-arrow-alt"></i><span class="menu-item" data-i18n="Analytics">Analytics</span></a>
                        </li>
                    </ul>
                </li> -->
                
                {% if perms.usr.crear_rol or perms.usr.crear_usuarios %}
                <li class=" nav-item"><a href="#"><i class="bx  bx-user"></i><span class="menu-title" data-i18n="Invoice">GESTIÓN DE USUARIOS</span></a>
                    <ul class="menu-content">
                        {% if perms.usr.crear_usuarios %}
                            <li><a href="{% url 'usr:usuarios_list' %}"><i class="bx bx-right-arrow-alt"></i><span class="menu-item" data-i18n="Invoice List">Usuarios</span></a>
                            </li>
                        {% endif %}
                        {% if perms.usr.crear_rol%}
                            <li><a href="{% url 'usr:roles_list' %}"><i class="bx bx-right-arrow-alt"></i><span class="menu-item" data-i18n="Invoice">Roles y Permisos</span></a>
                            </li>
                        {% endif %}
                    </ul>
                </li>
                {% endif %}
               
                
                
                {% if request.user.rol.descripcion == 'ADMINISTRADOR' %}
                <li class=" nav-item"><a href="#"><i class="bx  bx-truck"></i><span class="menu-title" data-i18n="Invoice">GESTIÓN DE PROVEED.</span></a>
                    <ul class="menu-content">
                        <li class=" nav-item"><a href="{% url 'prv:proveedores_list' %}"><i  class="bx bx-right-arrow-alt"> </i><span class="menu-title">Proveedores</span></a> 
                            <li><a href="{% url 'prv:categorias_prov_list' %}"><i class="bx bx-right-arrow-alt"></i><span class="menu-item" data-i18n="Invoice">Categorias Prov.</span></a>
                            </li>
                        </ul>
                </li>
                
                {% endif %}

                {% if perms.prd.crear_producto or request.user.rol.descripcion == 'BODEGUERO'   %}
                {% if request.user.rol.descripcion != 'PROVEEDOR' %}
                <li class=" nav-item"><a href=""><i class="bx bx-book-content "> </i><span class="menu-title">INVENTARIO</span></a> 
                    <ul class="menu-content">
                        {% if request.user.rol.descripcion == 'BODEGUERO'  or  perms.prd.crear_producto %}
                            
                            <li class=" nav-item"><a  href="{% url 'inv:stock_bodega' %}"><i class="bx bx-right-arrow-alt"></i><span class="menu-item" data-i18n="File Manager">Stock Insumos</span></a>
                            </li>
                            
                            
                        {% endif %}
                        
                        
                    </ul>
                </li>
                {% endif %}
                {% endif %}
                {% if perms.prd.crear_producto or request.user.rol.descripcion == 'ADMINISTRADOR'   %}
                <li class=" nav-item"><a href=""><i class="bx bx-store-alt "> </i><span class="menu-title">GESTIÓN DE INSUMOS</span></a> 
                    <ul class="menu-content">
                        {% if perms.prd.crear_producto %}
                        <li><a href="{% url 'prd:productos_list' %}"><i class="bx bx-right-arrow-alt"></i><span class="menu-item" data-i18n="Invoice">Insumos</span></a>
                        </li>
                        {% endif %}
                        <li><a href="{% url 'prd:categorias_insumos_list' %}"><i class="bx bx-right-arrow-alt"></i><span class="menu-item" data-i18n="Invoice">Categorias/Insumos.</span></a>
                        </li>
                    </ul>
                </li>
                {% endif %}





        
                {% if request.user.tipo_usuario.descripcion == 'USUARIO PR' %}
                <li class=" nav-item"><a href=""><i class="bx bx-map"> </i><span class="menu-title">Ubicaciones</span></a> 
                    <ul class="menu-content">
                        <!-- <li><a href="{% url 'ubc:pais_list' %}"><i class="bx bx-right-arrow-alt"></i><span class="menu-item" data-i18n="Invoice List">Pais</span></a>
                        </li> -->
                        <li><a href="{% url 'ubc:ciudad_list' %}"><i class="bx bx-right-arrow-alt"></i><span class="menu-item" data-i18n="Invoice">Ciudades</span></a>
                        </li>
                        
                        {% if request.user.tipo_usuario.descripcion == 'USUARIO INSUMOS' %}
                        <li><a href="{% url 'ubc:bodegas_list' %}"><i class="bx bx-right-arrow-alt"></i><span class="menu-item" data-i18n="Invoice">Bodega</span></a>
                        </li>
                        {% else %}
                        <li><a href="{% url 'ubc:sectores_list' %}"><i class="bx bx-right-arrow-alt"></i><span class="menu-item" data-i18n="Invoice">Sectores</span></a>
                        </li>
                        <li><a href="{% url 'ubc:lotes_list' %}"><i class="bx bx-right-arrow-alt"></i><span class="menu-item" data-i18n="Invoice">Lotes</span></a>
                        </li>
                        {% endif %}
                    </ul>
                </li>
                {% endif %}
                {% if request.user.tipo_usuario.descripcion == 'USUARIO PT' %}
                <li class="nav-item has-sub"><a href="#"><i class="bx bx-cog" data-icon="morph-menu-arrow-bottom"><span></span></i><span class="menu-title" data-i18n="Menu Levels">
                    {% if request.user.tipo_usuario.descripcion == 'USUARIO INSUMOS' %}Configuraciones{% endif%}</span></a>
                    <ul class="menu-content">
                        {% if request.user.tipo_usuario.descripcion == 'USUARIO PR' %}
                        
                        <li class="has-sub"><a href="#"><i class="bx bx-right-arrow-alt"></i><span class="menu-item" data-i18n="Second Level">Items</span></a>
                            <ul class="menu-content">
                                <li><a href=""><i class="bx bx-right-arrow-alt"></i><span class="menu-item" data-i18n="Third Level">Productos</span></a>
                                </li>
                                
                            </ul>
                        </li>
                        {% endif %}
                        {% if request.user.tipo_usuario.descripcion == 'USUARIO INSUMOS'  %}
                        <li class="has-sub"><a href="#"><i class="bx bx-right-arrow-alt"></i><span class="menu-item" data-i18n="Second Level">Personal</span></a>
                            <ul class="menu-content">
                                <li><a href="{% url 'personal:empleados_list' %}"><i class="bx bx-circle"></i><span class="menu-item" data-i18n="File Manager">Empleados</span></a>
                                </li>
                                <li><a href="{% url 'personal:tipos_list' %}"><i class="bx bx-circle"></i><span class="menu-item" data-i18n="File Manager">Tipo Empleado</span></a>
                                </li>
                                <li><a href="{% url 'personal:categorias_list' %}"><i class="bx bx-circle"></i><span class="menu-item" data-i18n="File Manager">Categoria Empleado</span></a>
                                </li>
                            </ul>
                        </li>
                        {% endif %}
                    </ul>
                </li>
                {% endif %}
                
               
                <li class=" nav-item"><a href=""><i class="bx bx-transfer-alt"> </i><span class="menu-title">TRANSACCIONES</span></a> 
                    <ul class="menu-content">
                        {% if perms.trn.ver_ordenes_proveedor or perms.trn.crear_orden_produccion %}
                <li class=" nav-item"><a href=""><i class="bx bx-copy-alt"> </i><span class="menu-title">Solicitudes</span></a> 
                    <ul class="menu-content">
                        {% if perms.trn.ver_ordenes_proveedor  %}
                        <li><a href="{% url 'trn:pedidos_list' %}"><i class="bx bx-right-arrow-alt"></i><span class="menu-item" data-i18n="Invoice">Solicitudes de Pedidos</span></a>
                        </li>
                        {% endif %}
                        {% if perms.trn.crear_orden_produccion  %}
                        
                        <li><a href="{% url 'trn:orden_produccion_list' %}"><i class="bx bx-right-arrow-alt"></i><span class="menu-item" data-i18n="Invoice">Solicitud de Insumos </span></a>
                        </li>
                        {% endif %}
                        
                        
                    </ul>
                </li>
                {% endif %}
                {% if perms.trn.ver_orden_ingreso  %}
                <li class=" nav-item"><a href=""><i class="bx bx-transfer-alt"> </i><span class="menu-title">Gestión de Bodega</span></a> 
                    <ul class="menu-content">
                        
                        {% if perms.trn.ver_orden_ingreso  %}

                        <li><a href="{% url 'trn:ingresos_list' %}"><i class="bx bx-right-arrow-alt"></i><span class="menu-item" data-i18n="Invoice">Ingresos de Bodega</span></a>
                        </li>
                        {% endif %}
                        {% if perms.trn.ver_orden_salida  %}

                        <li><a href="{% url 'trn:ordenes_salida_list' %}"><i class="bx bx-right-arrow-alt"></i><span class="menu-item" data-i18n="Invoice">Salidas de Bodega</span></a>
                        </li>
                        {% endif %}
                        
                        
                    </ul>
                </li>
                {% endif %}
                    </ul>
                </li>
                
                
                
                


                {% if request.user.rol.descripcion == 'ADMINISTRADOR' %}
                
                <li class=" nav-item"><a ><i class='bx bx-doughnut-chart'></i><span class="menu-title">MANTENIMIENTO</span></a>
                    <ul class="menu-content">
                        <li><a href="{% url 'ubc:bodegas_list' %}"><i class="bx bx-map"></i><span class="menu-item" data-i18n="Invoice">Bodega</span></a>
                        </li>
                        <!-- <li><a onclick="sitioAdmin()"><i class="bx bx-right-arrow-alt"></i><span class="menu-item" data-i18n="Invoice">Configuraciones Generales</span></a>
                        </li> -->
                        <li><a href="{% url 'ubc:ciudad_list' %}"><i class="bx bx-map"></i><span class="menu-item" data-i18n="Invoice">Ciudades</span></a>
                        </li>
                        <li><a href="{% url 'ubc:pais_list' %}"><i class="bx bx-map"></i><span class="menu-item" data-i18n="Invoice List">Pais</span></a>
                        </li>
                    </ul>
                </li>
                
                {% endif %}
                <li class=" nav-item"><a href=""><i class="bx bx-file"> </i><span class="menu-title">REPORTES</span></a> 
                    <ul class="menu-content">
                       
                        
                        <li><a href="{% url 'bases:reportes_list' %}"><i class="bx bx-download"></i><span class="menu-item" data-i18n="Invoice">Archivos Descarga</span></a>
                        </li>
                        
                        
                    </ul>
                </li>


                
                
               
                
            </ul>
        </div>
    </div>
    <!-- END: Main Menu-->
    {% endblock side_bar %}


    
    <!-- BEGIN: Content-->
    {% block content %}

    <div class="app-content content">
        <div class="content-overlay"></div>
        <div class="content-wrapper">
            <div class="content-header row">
            </div>
            <div class="content-body">
                
            </div>
        </div>
    </div>
    {% endblock content %}

    <!-- END: Content-->

    <!-- demo chat-->
   
    <div class="sidenav-overlay"></div>
    <div class="drag-target"></div>

    <!-- BEGIN: Footer-->
    <footer class="footer footer-static footer-dark">
        <p class="clearfix mb-0"><span class="float-left d-inline-block"><script>document.write(new Date().getFullYear());</script> &copy; Frutyfi</span><span class="float-right d-sm-inline-block d-none"></span>
            <button class="btn btn-primary btn-icon scroll-top" type="button"><i class="bx bx-up-arrow-alt"></i></button>
        </p>
    </footer>
    <!-- END: Footer-->

    <!-- popup -->
    <dv class="modal fade" id="popup">

    </dv>

    
<div class="loader">
    <div class="lds-spinner"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
</div>


    <!-- BEGIN: Vendor JS-->
    <script src="{% static  'base/app-assets/vendors/js/vendors.min.js' %}"></script>
    <script src="{% static  'base/app-assets/fonts/LivIconsEvo/js/LivIconsEvo.tools.js' %}"></script>
    <script src="{% static  'base/app-assets/fonts/LivIconsEvo/js/LivIconsEvo.defaults.js' %}"></script>
    <script src="{% static  'base/app-assets/fonts/LivIconsEvo/js/LivIconsEvo.min.js' %}"></script>
    <!-- BEGIN Vendor JS-->

    <!-- BEGIN: Page Vendor JS-->
    <script src="{% static  'base/app-assets/vendors/js/tables/datatable/datatables.min.js' %}"></script>
    <script src="{% static  'base/app-assets/vendors/js/tables/datatable/dataTables.bootstrap4.min.js' %}"></script>
    <script src="{% static  'base/app-assets/vendors/js/forms/validation/jquery.validate.min.js' %}"></script>
    <!-- END: Page Vendor JS-->

    <!-- BEGIN: Theme JS-->
    <script src="{% static  'base/app-assets/js/scripts/configs/vertical-menu-light.js' %}"></script>
    <script src="{% static  'base/app-assets/js/core/app-menu.js' %}"></script>
    <script src="{% static  'base/app-assets/js/core/app.js' %}"></script>
    <script src="{% static  'base/app-assets/js/scripts/components.js' %}"></script>
    <script src="{% static  'base/app-assets/js/scripts/footer.js' %}"></script>
    <!-- END: Theme JS-->

    <!-- BEGIN: Page JS-->
    <script src="{% static  'base/app-assets/js/scripts/datatables/datatable.js' %}"></script>
    <script src="{% static  'base/app-assets/js/scripts/modal/components-modal.js' %}"></script>
    <!-- END: Page JS-->

    <!-- BEGIN: Page Vendor JS-->
    <script src="{% static 'base/app-assets/vendors/js/extensions/swiper.min.js' %}"></script>
    <!-- END: Page Vendor JS-->
    <!-- BEGIN: Page JS-->
    <script src="{% static 'base/app-assets/js/scripts/extensions/swiper.js' %}"></script>
    <!-- END: Page JS-->

    <!-- jQuery confirm-->
    <script src="{% static 'base/vendor/jquery_confirm/dist/jquery-confirm.min.js' %}"></script>
    <script src="{% static 'base/js/jquery.maskMoney.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9.7.2/dist/sweetalert2.all.min.js"></script>

    <!-- Select 2 -->
    <!-- END: Select 2 -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.full.min.js" integrity="sha256-FEqEelWI3WouFOo2VWP/uJfs1y8KJ++FLh2Lbqc8SJk=" crossorigin="anonymous"></script>

    <script src="{% static 'base/app-assets/vendors/js/extensions/toastr.min.js' %}"></script>
    <script src="{% static 'base/app-assets/js/scripts/extensions/toastr.js' %}"></script>
    <script src="{% static 'base/app-assets/vendors/js/charts/apexcharts.js' %}"></script>
    <script src="{% static 'base/app-assets/vendors/js/charts/apexcharts.min.js' %}"></script>


    <script src="{% static 'base/app-assets/js/scripts/tooltip/tooltip.min.js' %}"></script>
    <script src="{% static 'base/app-assets/js/scripts/tooltip/tooltip.js' %}"></script>

    
    <script src="{% static 'base/app-assets/js/sweetalert.js' %}"></script>
    <script src="{% static 'base/app-assets/js/jquery-3.2.0.min.js' %}"></script>

    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.12/dist/js/select2.min.js"></script>

    <script src="{% static 'base/app-assets/vendors/js/forms/select/select2.full.min.js' %}"></script>
    <script src="{% static 'base/app-assets/js/scripts/forms/select/form-select2.js' %}"></script>
    
    
    <script>
        function abrir_modal(url){
            $("#popup").load(url, function(){
                $(this).modal({
                    backdrop:'static',
                    keyboard: false,
                    })
                $(this).modal('show');
            });
            return false;

        }
        
        function cerrar_modal(){
            $('#popup').modal('hide');
            return false;
        }

        $(document).ready(function() {
            audio = new Audio('{% static "base/audio/audio.mp3" %}');
            $('.loader').hide();
            obtenerDatosClima();

            cargarNotificacion();
        })

        function obtenerDatosClima(){
            // $('.text-temperatura').text('hola')
            $.ajax({
                url: '{% url "bases:datos_clima" %}',
                type: 'GET',
                data: {},
                success: function(response){
                    temperatura(response.url)
                }
            })
        }

        function temperatura(string_url){
            $.ajax({
                url: string_url,
                type: 'GET',
                data: {},
                success: function(response){
                    var temperatura_min = response.main.temp_min
                    var temperatura_max = response.main.temp_max

                    $('.text-temperatura_min').text(' '+temperatura_min+'°C')
                    $('.text-temperatura_max').text(' '+temperatura_max+'°C')


                }
            })
        }


        function sitioAdmin(){
            setTimeout(() => {
                url = 'http://'+window.location.host+'/admin';
                window.location.href = url
            }, 200);
        }

        // //sockect
        var roomName = '{{ request.user.pais.descripcion }}';
        roomName = roomName.toLowerCase();

        let protocolo;
        if(window.location.protocol === 'https:'){
            protocolo = 'wss://';
        }else{
            protocolo = 'ws://';
        }

        ruta = protocolo+window.location.host+'/ws/websocket/'+roomName+'/';
        var wsSocket = new WebSocket(ruta);

        // console.log(wsSocket)
        wsSocket.onmessage = function(e) {
            var data = JSON.parse(e.data);
            var message = data['message'];
            // console.log('recibido: ' + message);
            cargarNotificacion()
            

        };

        wsSocket.onclose = function(e) {
            console.error('Socket cerrado');
        };

        function cargarNotificacion(){
            $('.loader').show();
            url = '{% url "ntf:obtener_notificacion"  %}';
            if('{{request.user.proveedor}}' === ''){
                usuario_id = '{{request.user.id}}'
            }else{
                usuario_id = '{{request.user.proveedor.id_proveedor}}'
            }
            data = {
                'usuario_id': usuario_id
            }
            $.ajax({
                url : url,
                type: 'GET',
                data: data,
                success: function(response){
                    console.log(response)
                    $('.loader').hide();
                    notificacion = response.data
                    if(parseInt('{{request.user.id}}') === parseInt(notificacion.encargado) && notificacion.orden_prd != null && notificacion.orden_prv == null && notificacion.orden_id == null){
                        
                        alerta = $.confirm({
                            lazyOpen: true,
                            title: '{% trans "Solicitud de Insumos" %}',
                            content: '{% trans "Se genero una nueva solicitude insumos para trabajos de campo." %}',
                            theme: 'supervan',
                            buttons: {
                                confirm: {
                                    text: '{% trans "Aceptar" %}',
                                    action: function() {
                                        actualizarNotificacion(notificacion.id_notificacion);
                                    }
                                },
                            
                            }
                        });
                        alerta.open();
                    }
                    if(parseInt('{{request.user.proveedor.id_proveedor}}') === parseInt(notificacion.proveedor_id) && notificacion.orden_prd == null && notificacion.orden_prv != null && notificacion.orden_id == null){
                        alerta = $.confirm({
                        lazyOpen: true,
                        title: '{% trans "Solicitud de pedido" %}',
                        content: '{% trans "Se genero una nueva Solicitud" %}',
                        theme: 'supervan',
                        buttons: {
                            confirm: {
                                text: '{% trans "Aceptar" %}',
                                action: function() {
                                    actualizarNotificacion(notificacion.id_notificacion);
                                    
                                }
                            },
                        
                            }
                        });
                        alerta.open();

                    }
                    
                    if(parseInt('{{request.user.id}}') === parseInt(notificacion.encargado) && notificacion.vista === false && notificacion.estado_id === 16){
                        alerta = $.confirm({
                        lazyOpen: true,
                        title: '{% trans "Solcitiud Despachada" %}',
                        content: '{% trans "Los insumos estan listos por parte del proveedor" %}',
                        theme: 'supervan',
                        buttons: {
                            confirm: {
                                text: '{% trans "Aceptar" %}',
                                action: function() {
                                    actualizarNotificacion(notificacion.id_notificacion);
                                    
                                }
                            },
                        
                            }
                        });
                        alerta.open();

                    }

                    if(parseInt('{{request.user.id}}') === parseInt(notificacion.encargado) && notificacion.vista === false && notificacion.estado_id === 3 && notificacion.descripcion_bodega === 'ENTRADA'){
                        alerta = $.confirm({
                        lazyOpen: true,
                        title: '{% trans "Orden Ingreso a Bodega Generada" %}',
                        content: '{% trans "Solicitud de pedido finalizada, puede proceder al almacenamiento de los insumos." %}',
                        theme: 'supervan',
                        buttons: {
                            confirm: {
                                text: '{% trans "Aceptar" %}',
                                action: function() {
                                    actualizarNotificacion(notificacion.id_notificacion);
                                    
                                }
                            },
                        
                            }
                        });
                        alerta.open();

                    }

                    if(parseInt('{{request.user.id}}') === parseInt(notificacion.encargado) && notificacion.vista === false && notificacion.estado_id === 3 && notificacion.descripcion_bodega === 'SALIDA'){
                        alerta = $.confirm({
                        lazyOpen: true,
                        title: '{% trans "Orden de Salida de Bodega Generada" %}',
                        content: '{% trans "Realizar la revision y entrega de los insumos." %}',
                        theme: 'supervan',
                        buttons: {
                            confirm: {
                                text: '{% trans "Aceptar" %}',
                                action: function() {
                                    actualizarNotificacion(notificacion.id_notificacion);
                                }
                            },
                        
                            }
                        });
                        alerta.open();

                    }
                    
                        


                        
                }
            })
        }

        function actualizarNotificacion(id){
            $.ajax({
                url : '{% url "ntf:actualizar_notificacion" %}',
                type: 'GET',
                data: {'idNotificacion': id},
                success: function(response){
                    console.log('ok')
                    // location.reload(true)
                }
            })

        }

    </script>
<script src="{% static 'base/js/hummingbird-treeview.js' %}"></script>

</body>
<!-- END: Body-->
{% block js_page %}
    
{% endblock %}

</html>
